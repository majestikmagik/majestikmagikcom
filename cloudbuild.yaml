substitutions:
  _FRONTEND_REGION: us-central1
  _BACKEND_REGION: us-east4
  _REPO: majestikmagik
  _FRONTEND_SERVICE: majestikmagikcom
  _BACKEND_SERVICE: majestikmagik-api

steps:
  - name: gcr.io/cloud-builders/docker
    dir: frontend
    args:
      - build
      - -t
      - ${_FRONTEND_REGION}-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_FRONTEND_SERVICE}:$COMMIT_SHA
      - -f
      - Dockerfile
      - .

  - name: gcr.io/cloud-builders/docker
    dir: backend
    args:
      - build
      - -t
      - ${_BACKEND_REGION}-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_BACKEND_SERVICE}:$COMMIT_SHA
      - -f
      - Dockerfile
      - .

images:
  - ${_FRONTEND_REGION}-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_FRONTEND_SERVICE}:$COMMIT_SHA
  - ${_BACKEND_REGION}-docker.pkg.dev/$PROJECT_ID/${_REPO}/${_BACKEND_SERVICE}:$COMMIT_SHA
